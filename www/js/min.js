function PrimeGenerator(a){this.primeNumberList=a}PrimeGenerator.prototype.isPrime=function(a){if(0==a%2)return!1;for(var c=0;c<this.primeNumberList.length;c++)if(0==a%this.primeNumberList[c])return!1;return!0};PrimeGenerator.prototype.getPrimeNumberList=function(){return this.primeNumberList};PrimeGenerator.prototype.generateNextPrime=function(){for(var a=this.primeNumberList[this.primeNumberList.length-1]+1;!this.isPrime(a);)a++;this.primeNumberList.push(a)};
PrimeGenerator.prototype.getRandomPrime=function(a,c){for(;this.primeNumberList.length<c-1;)this.generateNextPrime();return vlu=this.primeNumberList[a+Math.floor(Math.random()*(c-a-1))]};PrimeGenerator.prototype.getNthPrime=function(a){for(;this.primeNumberList.length<a;)this.generateNextPrime();return this.primeNumberList[a-1]};
function SquareBoard(a,c,d,b){this.boardColors="#FFFF00 #1CE6FF #FF34FF #FF4A46 #008941 #006FA6 #A30059 #FFDBE5 #7A4900 #63FFAC #B79762 #004D43 #8FB0FF #997D87 #809693 #FEFFE6 #1B4400 #4FC601 #3B5DFF #4A3B53 #FF2F80 #BA0900 #6B7900 #00C2A0 #FFAA92 #FF90C9 #B903AA #D16100 #DDEFFF #7B4F4B #A1C299 #0AA6D8 #00846F #FFB500 #C2FFED #A079BF #CC0744 #C0B9B2 #C2FF99 #00489C #6F0062 #0CBD66 #EEC3FF #456D75 #B77B68 #7A87A1 #788D66 #885578 #FAD09F #FF8A9A #D157A0 #BEC459 #456648 #0086ED #886F4C #B4A8BD #00A6AA #A3C8C9 #FF913F #938A81 #00FECF #B05B6F #8CD0FF #3B9700 #04F757 #C8A1A1 #1E6E00 #7900D7 #A77500 #6367A9 #A05837 #D790FF #9B9700 #549E79 #FFF69F #72418F #BC23FF #99ADC0 #922329 #5B4534 #FDE8DC #404E55 #0089A3 #CB7E98 #A4E804 #324E72 #6A3A4C #83AB58 #D1F7CE #004B28 #C8D0F6 #A3A489 #806C66 #BF5650 #66796D #DA007C #FF1A59 #8ADBB4 #5B4E51 #C895C5 #FF6832 #66E1D3 #CFCDAC #D0AC94 #7ED379".split(" ");var e=
this;this.primeGenerator=a;this.nthPrime=void 0==c||"NaN"==c?5:c;this.operator=d;this.maxOp=b;this.numberUpdateListener=function(a){a=e.squareGoal.checkGoal(e.squareNumbers);0==a&&e.squareGoal.newGoal(e.squareNumbers);e.updateFunction(a)};this.reset(this.nthPrime)}
SquareBoard.prototype.reset=function(a){this.nthPrime=a;this.squareNumbers={};this.squareGoal={};a={};var c={},d=!1;lowestPrime=0;100<this.nthPrime&&(lowestPrime=Math.floor(.25*this.nthPrime));difficutlnumbers=5;for(var b=0;24>b;b++){var e=0;0==d&&.3>Math.random()?(e=this.primeGenerator.getNthPrime(this.nthPrime),d=!0):10<this.nthPrime&&0<difficutlnumbers&&.3>Math.random()?(e=this.primeGenerator.getRandomPrime(Math.floor(.75*this.nthPrime),this.nthPrime),difficutlnumbers--):e=this.primeGenerator.getRandomPrime(lowestPrime,
this.nthPrime);if(void 0==c[e]){for(var g=this.boardColors[Math.floor(Math.random()*this.boardColors.length)];void 0!=a[g];)g=this.boardColors[Math.floor(Math.random()*this.boardColors.length)];a[g]=e;c[e]=g}this.squareNumbers["cell"+b]=new SquareNumber(b,e,c[e],this.numberUpdateListener)}this.squareGoal=new SquareGoal(this.squareNumbers,this.operator,this.maxOp)};SquareBoard.prototype.setUpdateListener=function(a){this.updateFunction=a};
SquareBoard.prototype.getNumbersLeft=function(){for(var a=0,c=0;24>c;c++)1==this.squareNumbers["cell"+c].isNumberAvailable()&&a++;return a};SquareBoard.prototype.getGoal=function(){return this.squareGoal};SquareBoard.prototype.getSquareNumbers=function(){return this.squareNumbers};function SquareConfiguration(){}
function SquareGame(a,c,d){var b=this;this.minOperations=this.maxOperations=2;this.updateFunction=c;this.lastTriesStr=this.lastTimeStr="";try{if(this.configurationData=jQuery.parseJSON(a),0!==this.configurationData.storyModeLevel5x5%1)throw"Unreadable";}catch(e){this.configurationData=jQuery.parseJSON("{}"),this.configurationData.storyModeLevel5x5=5,this.configurationData.primeArray=[2,3,5,7]}this.primeGenerator=new PrimeGenerator(this.configurationData.primeArray);this.maxPrime=this.configurationData.storyModeLevel5x5;
this.squareBoard=new SquareBoard(this.primeGenerator,this.maxPrime,"+",2);this.squareBoard.setUpdateListener(function(a){1==a&&b.triesLeft--;0==a&&(b.timeLeft+=5);var f=b.timeLeft,e=Math.floor(f/60),f=f-60*e,f=(10>e?"0"+e:e)+":"+(10>f?"0"+f:f);0>=b.triesLeft&&(b.triesLeft=0);e=b.triesLeft;b.lastTimeStr=f;b.lastTriesStr=e;var h=!1;1==a&&(h=!0);c(f,e,h);0>=b.triesLeft||0>=b.timeLeft?(b.redrawBoard(),d(!1)):0==b.getSquareBoard().getGoal().getGoalValue()&&(b.configurationData.storyModeLevel5x5+=1,b.configurationData.primeArray=
b.primeGenerator.getPrimeNumberList(),b.isPaused=!0,d(!0))});this.triesLeft=3;this.timeLeft=90;this.isPaused=!0;setInterval(function(){if(1!=b.isPaused){b.timeLeft--;0>=b.timeLeft&&(b.timeLeft=0);var a=b.timeLeft,e=Math.floor(a/60),a=a-60*e,a=(10>e?"0"+e:e)+":"+(10>a?"0"+a:a),e=b.triesLeft;b.lastTimeStr=a;b.lastTriesStr=e;c(a,e);if(0>=b.triesLeft||0>=b.timeLeft)b.redrawBoard(),d(!1)}},990)}
SquareGame.prototype.resetConfiguration=function(){this.maxPrime=5;this.configurationData.storyModeLevel5x5=5};SquareGame.prototype.getLevelData=function(){return JSON.stringify(this.configurationData)};SquareGame.prototype.redrawBoard=function(){this.timeLeft=90;this.triesLeft=3;this.squareBoard.reset(this.configurationData.storyModeLevel5x5);this.isPaused=!0};SquareGame.prototype.getCurrentLevel=function(){return this.primeGenerator.getNthPrime(this.configurationData.storyModeLevel5x5)};
SquareGame.prototype.startGame=function(){this.isPaused=!1};SquareGame.prototype.isRunning=function(){return!this.isPaused};SquareGame.prototype.pauseGame=function(){this.isPaused=!0};SquareGame.prototype.getTriesLeft=function(){return this.lastTriesStr};SquareGame.prototype.getTimeLeft=function(){return this.lastTimeStr};SquareGame.prototype.getNumbersLeft=function(){return this.squareBoard.getNumbersLeft()};SquareGame.prototype.getMaxOperations=function(){return this.maxOperations};
SquareGame.prototype.getMinOperations=function(){return this.minOperations};SquareGame.prototype.getMaxPrime=function(){return this.maxPrime};SquareGame.prototype.getPrimeGenerator=function(){return this.primeGenerator};SquareGame.prototype.getSquareBoard=function(){return this.squareBoard};function SquareGoal(a,c,d,b){this.opMax=b;this.goalListener=c;this.operator=d;this.goalValue=0;this.newGoal(a)}
SquareGoal.prototype.newGoal=function(a){this.goalValue=0;for(var c=[],d=0;24>d;d++)a["cell"+d].isNumberAvailable()&&c.push(a["cell"+d]);for(var d=c.length,b;0!==d;)b=Math.floor(Math.random()*d),d-=1,a=c[d],c[d]=c[b],c[b]=a;a=2;a>c.length&&(a=c.length);for(d=0;0<a;)this.goalValue+=c[d].getNumberValue(),a--,d++};
SquareGoal.prototype.checkGoal=function(a){for(var c=0,d=[],b=0;24>b;b++)1==a["cell"+b].isNumberAvailable()&&1==a["cell"+b].isNumberSelected()&&(c+=a["cell"+b].getNumberValue(),d.push(a["cell"+b]));if(c==this.goalValue){for(a=0;a<d.length;a++)d[a].deactivate_noEvent();return 0}if(c>this.goalValue){for(a=0;a<d.length;a++)d[a].deselect_noEvent();return 1}return-1};SquareGoal.prototype.getGoalValue=function(){return this.goalValue};
function SquareNumber(a,c,d,b){this.item_position=a;this.value=c;this.available=!0;this.selected=!1;this.item_color=d;this.boardCallback=b}SquareNumber.prototype.deselect_noEvent=function(){this.selected=!1};SquareNumber.prototype.deactivate_noEvent=function(){this.available=!1};SquareNumber.prototype.getItemColor=function(){return this.item_color};SquareNumber.prototype.getNumberValue=function(){return this.value};SquareNumber.prototype.isNumberSelected=function(){return this.selected};
SquareNumber.prototype.isNumberAvailable=function(){return this.available};SquareNumber.prototype.deactivateNumber=function(){this.available=!1;this.boardCallback(this)};SquareNumber.prototype.selectNumber=function(){1==this.available&&(this.selected=!0,this.boardCallback(this))};SquareNumber.prototype.deselectNumber=function(){1==this.available&&(this.selected=!1,this.boardCallback(this))};SquareNumber.prototype.getItemId=function(){return"cell"+this.item_position};
function UserPanel(){this.headline="MathSquare";this.timeLeft=-1}var savedFS;function gotFS(a){savedFS=a;a.root.getFile("data.json",null,gotFileEntry,fail)}function gotFileEntry(a){a.file(gotFile,fail)}function gotFileEntryWriter(a){a.createWriter(gotFileWriter,fail)}function gotFile(a){readAsText(a)}function gotFileWriter(a){a.write(game.getLevelData());a.onwriteend=function(a){}}function readAsText(a){var c=new FileReader;c.onloadend=function(a){doneReading(a.target.result)};c.readAsText(a)}
function fail(a){doneReading(void 0)}var dataContent={},game={},isInitialized=!1,customvalue=0;refeshHeader=function(){};
doneReading=function(a){$("#loadingScreen").fadeOut(function(){$("#mainMenu").fadeIn()});game=new SquareGame(a,function(a,d,b){!0===b&&$("#gme").effect("bounce",{},500);void 0!=a&&void 0!=d&&(document.getElementById("header_inner_tries").innerHTML=d,document.getElementById("header_inner_time").innerHTML=a);1==game.isPaused?document.getElementById("cellgoal").style.opacity="0.0":document.getElementById("cellgoal").style.opacity="1.0";for(a=a=0;24>a;a++)d=game.getSquareBoard().getSquareNumbers()["cell"+
a],b=document.getElementById("cell"+a),1==game.isPaused?b.innerHTML="":""==b.innerHTML&&(b.innerHTML=d.getNumberValue()),1==d.isNumberAvailable()?0==d.isNumberSelected()&&(jQuery("#cell"+a).removeClass("selected"),d.deselect_noEvent()):jQuery("#cell"+a).animate({opacity:"0.0"});document.getElementById("cellgoal").innerHTML=game.getSquareBoard().getGoal().getGoalValue();$("#cellgoal").inflateText({maxFontSize:.7*customvalue,minFontSize:12,scale:1})},function(a){1==a?(document.getElementById("content2").innerHTML=
game.getCurrentLevel(),document.getElementById("nextLevelIs").innerHTML=game.getCurrentLevel(),document.getElementById("wincontent1").style.fontSize=.35*sizeContent*.2+"px",document.getElementById("wincontent2").style.fontSize=.35*sizeContent*.2+"px",document.getElementById("nextLevelIs").style.fontSize=.175*sizeContent+"px",$("#gameMenu").fadeOut(function(){$("#winMenu").fadeIn()}),savedFS.root.getFile("data.json",{create:!0,exclusive:!1},gotFileEntryWriter,fail)):(document.getElementById("losecontent1").style.fontSize=
.35*sizeContent*.2+"px",document.getElementById("losecontent2").style.fontSize=.35*sizeContent*.2+"px",$("#gameMenu").fadeOut(function(){$("#loseMenu").fadeIn()}))});document.getElementById("content2").innerHTML=game.getCurrentLevel()};
initBoard=function(){if(1!=isInitialized){customvalue=($(window).width()-40-10-20)/5;heightleft=.3*($(window).height()-$(window).width()-Math.floor($(window).width()/4*.15));0>heightleft&&(heightleft=0);document.getElementById("gme").style.marginTop=heightleft+"px";elementArray=document.getElementsByClassName("header_desc");for(i=i=0;i<elementArray.length;i++)elementArray[i].style.setProperty("font-size",Math.floor($(window).width()/4*.15)+"px");elementArray=document.getElementsByClassName("header_val");
for(i=i=0;i<elementArray.length;i++)elementArray[i].style.setProperty("font-size",Math.floor(.3*Math.floor($(window).width()/4))+"px");elementArray=document.getElementsByClassName("header_inner");for(i=i=0;i<elementArray.length;i++)elementArray[i].style.setProperty("width","30%");document.getElementById("header_inner_c").style.setProperty("left",Math.floor($(window).width()/2-$(window).width()/4/2)+"px");document.getElementById("header_inner_c").style.setProperty("width",Math.floor($(window).width()/
4)+"px");document.getElementById("header_inner_l").style.setProperty("margin-left",.08*$(window).width()+"px");document.getElementById("header_inner_r").style.setProperty("margin-right",.08*$(window).width()+"px");for(i=0;24>i;i++)document.getElementById("cell"+i).style.setProperty("width",customvalue+"px"),document.getElementById("cell"+i).style.setProperty("height",customvalue+"px"),document.getElementById("cell"+i).style.setProperty("max-width",customvalue+"px"),document.getElementById("cell"+
i).style.setProperty("max-height",customvalue+"px");document.getElementById("cellgoal").style.setProperty("width",customvalue+"px");document.getElementById("cellgoal").style.setProperty("height",customvalue+"px");document.getElementById("cellgoal").style.setProperty("max-width",customvalue+"px");document.getElementById("cellgoal").style.setProperty("max-height",customvalue+"px");$("#cellgoal").inflateText({maxFontSize:.7*customvalue,minFontSize:12,scale:1});$("#header_inner_c").inflateText({maxFontSize:.7*
customvalue,minFontSize:12,scale:.8});$(".cell").inflateText({maxFontSize:.7*customvalue,minFontSize:12,scale:.8});document.getElementById("gme")}};
restBoard=function(){initBoard();for(var a=0;24>a;a++){var c=game.getSquareBoard().getSquareNumbers()["cell"+a];document.getElementById("cell"+a).innerHTML=c.getNumberValue();document.getElementById("cell"+a).style.opacity="1.0";document.getElementById("cell"+a).style.setProperty("color",c.getItemColor())}document.getElementById("cellgoal").innerHTML=game.getSquareBoard().getGoal().getGoalValue();$("#cellgoal").inflateText({maxFontSize:.7*customvalue,minFontSize:12,scale:1});$("#header_inner_c").inflateText({maxFontSize:.7*
customvalue,minFontSize:12,scale:.8});$(".cell").inflateText({maxFontSize:.7*customvalue,minFontSize:12,scale:.8})};$("div.cell").click(function(){var a=game.getSquareBoard().getSquareNumbers()[$(this).attr("id")];void 0!=a&&1==a.isNumberAvailable()&&(1==a.isNumberSelected()?($(this).removeClass("selected"),a.deselectNumber()):($(this).addClass("selected"),a.selectNumber()))});
jQuery("#pauseMenu_continue").click(function(){$("#pauseMenu").fadeOut(function(){$("#gameMenu").fadeIn()});refeshHeader();game.startGame()});jQuery("#pauseMenu_restart").click(function(){game.redrawBoard();restBoard();$("#pauseMenu").fadeOut(function(){$("#gameMenu").fadeIn()});refeshHeader();game.startGame()});
jQuery("#mainMenu_reset_yes").click(function(){$("#mainMenu_reset_confirm").fadeOut(function(){$("#mainMenu_reset").fadeIn()});game.resetConfiguration();document.getElementById("content2").innerHTML=game.getCurrentLevel();savedFS.root.getFile("data.json",{create:!0,exclusive:!1},gotFileEntryWriter,fail);game.redrawBoard();restBoard()});jQuery("#mainMenu_reset_no").click(function(){game.redrawBoard();restBoard();$("#mainMenu_reset_confirm").fadeOut(function(){$("#mainMenu_reset").fadeIn()})});
jQuery("#mainMenu_reset").click(function(){game.redrawBoard();restBoard();$("#mainMenu_reset").fadeOut(function(){$("#mainMenu_reset_confirm").fadeIn();setTimeout(function(){$("#mainMenu_reset_confirm").fadeOut(function(){$("#mainMenu_reset").fadeIn()})},5E3)});game.startGame()});jQuery("#mainMenu_play").click(function(){game.redrawBoard();restBoard();$("#mainMenu").fadeOut(function(){$("#gameMenu").fadeIn()});refeshHeader();game.startGame()});
jQuery("#loseMenu_mainMenu").click(function(){game.redrawBoard();$("#loseMenu").fadeOut(function(){$("#mainMenu").fadeIn()});refeshHeader()});jQuery("#pauseMenu_mainMenu").click(function(){game.redrawBoard();$("#pauseMenu").fadeOut(function(){$("#mainMenu").fadeIn()});refeshHeader()});jQuery("#winMenu_play").click(function(){game.redrawBoard();restBoard();refeshHeader();$("#winMenu").fadeOut(function(){$("#gameMenu").fadeIn()});game.startGame()});
jQuery("#mainMenu_help").click(function(){restBoard();$("#mainMenu").fadeOut(function(){$("#helpMenu").fadeIn()});$(".inflatethis").inflateText({maxFontSize:200,minFontSize:12,scale:1});refeshHeader()});jQuery("#winMenu_mainMenu").click(function(){$("#winMenu").fadeOut(function(){$("#mainMenu").fadeIn()});refeshHeader()});jQuery("#helpMenu_mainMenu").click(function(){$("#helpMenu").fadeOut(function(){$("#mainMenu").fadeIn()});refeshHeader()});
jQuery("#loseMenu_restart").click(function(){game.redrawBoard();restBoard();$("#loseMenu").fadeOut(function(){$("#gameMenu").fadeIn()});refeshHeader();game.startGame()});jQuery("#header_inner_c").click(function(){game.pauseGame();document.getElementById("timeLeft").innerHTML=game.getTimeLeft();document.getElementById("triesLeft").innerHTML=game.getTriesLeft();document.getElementById("numbersLeft").innerHTML=game.getNumbersLeft();refeshHeader();$("#gameMenu").fadeOut(function(){$("#pauseMenu").fadeIn()})});
$("body").on("touchmove",function(a){a.preventDefault()});
for(var overallHeight=$(window).height(),sizePaddingTop=.05*overallHeight,sizeTitle=.1*overallHeight,sizeContent=.65*overallHeight,SizePaddingBottom=.05*overallHeight,elements=document.getElementsByClassName("headline"),eleCount=0,eleCount=0;eleCount<elements.length;eleCount++)elements[eleCount].style.paddingTop=sizePaddingTop+"px",elements[eleCount].style.fontSize=.6*sizeTitle+"px",elements[eleCount].style.height=sizeTitle+"px",elements[eleCount].style.lineHeight=sizeTitle+"px",elements[eleCount].style.paddingBottom=
sizePaddingTop+"px";eleCount=0;elements=document.getElementsByClassName("content");for(eleCount=0;eleCount<elements.length;eleCount++)elements[eleCount].style.height=sizeContent+"px";document.getElementById("helpContent").style.fontSize=.8*sizeContent*.05+"px";document.getElementById("content1").style.fontSize=.35*sizeContent*.2+"px";document.getElementById("content2").style.fontSize=.175*sizeContent+"px";document.getElementById("triesLeft").style.fontSize=.075*sizeContent+"px";
document.getElementById("triesLeft").style.height=.075*sizeContent+"px";document.getElementById("triesLeft_des").style.fontSize=.045*sizeContent+"px";document.getElementById("triesLeft_des").style.height=.075*sizeContent+"px";document.getElementById("timeLeft").style.fontSize=.075*sizeContent+"px";document.getElementById("timeLeft").style.height=.075*sizeContent+"px";document.getElementById("timeLeft_des").style.fontSize=.045*sizeContent+"px";
document.getElementById("timeLeft_des").style.height=.075*sizeContent+"px";document.getElementById("numbersLeft").style.fontSize=.075*sizeContent+"px";document.getElementById("numbersLeft").style.height=.075*sizeContent+"px";document.getElementById("numbersLeft_des").style.fontSize=.045*sizeContent+"px";document.getElementById("numbersLeft_des").style.height=.075*sizeContent+"px";
function onDeviceReady(){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,gotFS,fail);document.addEventListener("pause",function(){game.isRunning()&&(game.pauseGame(),document.getElementById("timeLeft").innerHTML=game.getTimeLeft(),document.getElementById("triesLeft").innerHTML=game.getTriesLeft(),document.getElementById("numbersLeft").innerHTML=game.getNumbersLeft(),refeshHeader(),$("#gameMenu").fadeOut(function(){$("#pauseMenu").fadeIn()}))},!1)}
document.addEventListener("deviceready",onDeviceReady,!1);
